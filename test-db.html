<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Database Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
        }
        button {
            padding: 10px 20px;
            margin: 10px 5px;
            cursor: pointer;
        }
        .result {
            margin-top: 20px;
            padding: 15px;
            background: #f0f0f0;
            border-radius: 4px;
            white-space: pre-wrap;
            font-family: monospace;
        }
        .error {
            background: #ffebee;
            color: #c62828;
        }
        .success {
            background: #e8f5e9;
            color: #2e7d32;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Supabase Database Test</h1>

        <div>
            <button onclick="testConnection()">Test Connection</button>
            <button onclick="checkTable()">Check Table</button>
            <button onclick="createTable()">Create Table</button>
            <button onclick="insertTestStudent()">Insert Test Student</button>
            <button onclick="getAllStudents()">Get All Students</button>
        </div>

        <div id="result" class="result"></div>
    </div>

    <script type="module">
        import { createClient } from 'https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm';

        const supabaseUrl = 'https://0ec90b57d6e95fcbda19832f.supabase.co';
        const supabaseKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJib2x0IiwicmVmIjoiMGVjOTBiNTdkNmU5NWZjYmRhMTk4MzJmIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NTg4ODE1NzQsImV4cCI6MTc1ODg4MTU3NH0.9I8-U0x86Ak8t2DGaIk0HfvTSLsAyzdnz-Nw00mMkKw';

        const supabase = createClient(supabaseUrl, supabaseKey);

        function showResult(message, isError = false) {
            const resultDiv = document.getElementById('result');
            resultDiv.textContent = message;
            resultDiv.className = isError ? 'result error' : 'result success';
        }

        window.testConnection = async function() {
            try {
                const { data, error } = await supabase.from('students').select('count');
                if (error) {
                    showResult(`Connection test - Error: ${JSON.stringify(error, null, 2)}`, true);
                } else {
                    showResult(`Connection successful!\n${JSON.stringify(data, null, 2)}`);
                }
            } catch (err) {
                showResult(`Connection error: ${err.message}`, true);
            }
        };

        window.checkTable = async function() {
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .limit(1);

                if (error) {
                    showResult(`Table check - Error: ${JSON.stringify(error, null, 2)}\n\nThe table might not exist yet.`, true);
                } else {
                    showResult(`Table exists! Sample data:\n${JSON.stringify(data, null, 2)}`);
                }
            } catch (err) {
                showResult(`Check table error: ${err.message}`, true);
            }
        };

        window.createTable = async function() {
            showResult('Note: Table creation requires admin access. Please create the table manually in Supabase dashboard with:\n\n' +
                'CREATE TABLE students (\n' +
                '  id uuid PRIMARY KEY DEFAULT gen_random_uuid(),\n' +
                '  name text NOT NULL,\n' +
                '  roll_number text UNIQUE NOT NULL,\n' +
                '  marks integer NOT NULL CHECK (marks >= 0 AND marks <= 100),\n' +
                '  created_at timestamptz DEFAULT now(),\n' +
                '  updated_at timestamptz DEFAULT now()\n' +
                ');\n\n' +
                'ALTER TABLE students ENABLE ROW LEVEL SECURITY;\n\n' +
                'CREATE POLICY "Allow all operations" ON students FOR ALL USING (true) WITH CHECK (true);'
            );
        };

        window.insertTestStudent = async function() {
            try {
                const testStudent = {
                    name: 'Test Student',
                    roll_number: 'TEST' + Date.now(),
                    marks: 85
                };

                const { data, error } = await supabase
                    .from('students')
                    .insert([testStudent])
                    .select()
                    .single();

                if (error) {
                    showResult(`Insert error: ${JSON.stringify(error, null, 2)}`, true);
                } else {
                    showResult(`Student inserted successfully!\n${JSON.stringify(data, null, 2)}`);
                }
            } catch (err) {
                showResult(`Insert error: ${err.message}`, true);
            }
        };

        window.getAllStudents = async function() {
            try {
                const { data, error } = await supabase
                    .from('students')
                    .select('*')
                    .order('created_at', { ascending: false });

                if (error) {
                    showResult(`Get students error: ${JSON.stringify(error, null, 2)}`, true);
                } else {
                    showResult(`Found ${data.length} students:\n${JSON.stringify(data, null, 2)}`);
                }
            } catch (err) {
                showResult(`Get students error: ${err.message}`, true);
            }
        };

        showResult('Click a button to test database operations');
    </script>
</body>
</html>
